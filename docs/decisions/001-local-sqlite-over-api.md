# ADR-001: ローカルSQLite検索 vs API検索

## 状況

魚の検索機能を実装する際、以下の2つのアプローチが検討された：

1. **API検索方式**: 検索ごとに外部APIにリクエスト
2. **ローカル検索方式**: 起動時にデータをダウンロードしてローカルで検索

## 決定

**ローカルSQLite検索方式**を採用する。

## 理由

### 1. 全文検索の要件

MCPサーバーでは自然言語での検索が重要：

```
ユーザー: 「大きくて危険な深海魚を教えて」
必要な処理: Comments列での「大きい AND 危険 AND 深海」検索
```

API方式では事前定義されたパラメータでしか検索できないが、ローカルなら任意のテキスト検索が可能。

### 2. MCPと全文検索の相性

```
子供: 「かっこいい魚！」
MCP: Comments列で「かっこいい OR 美しい OR 格好良い」検索

子供: 「怖い魚は？」  
MCP: 「危険 OR 毒 OR 怖い OR 攻撃」で検索
```

### 3. パフォーマンスとユーザー体験

| 項目 | API検索 | ローカル検索 |
|------|---------|-------------|
| 初回コスト | 0MB | 21MB（1回のみ） |
| 検索1回あたり | 10-100KB | 0MB |
| レスポンス時間 | 1-2秒 | ミリ秒単位 |
| オフライン対応 | 不可 | 可能 |

### 4. FishBase APIの現状

- 従来のREST APIは廃止済み
- 現在はS3形式（Parquetファイル）のみ提供
- そのため必然的にローカル処理が必要

## 影響

### 正の影響
- 自然言語での柔軟な検索が可能
- 高速レスポンス（子供の集中力を維持）
- オフライン利用可能
- 複雑な検索クエリが可能

### 負の影響
- 初回起動時のダウンロード時間
- メモリ使用量の増加（約20-30MB）
- データの更新頻度がリアルタイムではない

## 実装への影響

- better-sqlite3の採用
- FTS5 Virtual Tableの使用（日本語全文検索）
- Parquetファイル読み込み処理の実装
- データベース初期化処理の追加